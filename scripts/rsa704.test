#!/bin/sh

filename() { echo $(git show -s --format='%ci' $1 | awk '//{ print $1, $2;}' | tr -d -c 0-9)-$(git show -s --format='%h' $1) ; }

M=`hostname`

d=`mktemp -d`
cd $d
git clone git+ssh://scm.gforge.inria.fr/git/cado-nfs/cado-nfs.git
cd cado-nfs
rev=`filename HEAD`
echo 'CFLAGS="-O3 -funroll-loops -DNDEBUG"' > local.sh
echo 'CXXFLAGS="-O3 -funroll-loops -DNDEBUG"' >> local.sh
unset MPIR
make makefb
make las
build/$M/sieve/makefb -alim 500000000 -maxbits 14 -poly /localdisk/tmp/rsa704/rsa704.poly -t 4 > /localdisk/tmp/rsa704/rsa704.roots
build/$M/sieve/las -poly /localdisk/tmp/rsa704/rsa704.poly -rlim 250000000 -alim 500000000 -lpbr 33 -lpba 33 -mfbr 66 -mfba 99 -fb /localdisk/tmp/rsa704/rsa704.roots -I 15 -q0 1000000000 -q1 1000010000 -alambda 3.2 -rlambda 2.1 -apowlim 32767 -rpowlim 32767 > /localdisk/cado-nfs/rsa704/$rev
cd $HOME
/bin/rm -fr $d

